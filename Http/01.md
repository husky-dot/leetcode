## HTTP/1.1 主要变更点

1. 增加了 Put delete 等新方法
2. 增加了缓存管理和控制
3. 明确了连接管理，允许持久连接
4. 允许响应数据分块，利于传输大文件
5. 强制要求 Host 头，让互联网主机托管成为可能


## HTPP/2.2 主要特点
1.二进制协议，不再是纯文本
2.可发起多个请求，废弃了 1.1的管道
3.使用专用算法压缩头部，减少数据传输量
4.允许服务器主动向客户端推送数据
5.增强了安全性，"事实上"要求加密通信。

小结：

1.HTTP协议始于三十年前蒂姆伯纳斯-李的一篇论文
2.HTTP/0.9是个简单的文本协议，只能获取文本资源
3.HTTP/1.0 确立了大部分现在使用的技术，但它不是正式标准。
4.HTTP/1.1 是目前互联网上使用最广泛的协议，功能也非常完善
5.HTTP/2 基于 Google 的 SPDY 协议，注重性能改善，但还未来普及
6.HTTP/3 基于 Google 的 QUIC 协议，是将来的发展方向。


**什么是 HTTP**

HTTP 是一个在计算机世界里专门在两点之间传输文字，图片，音频，视频等超文本数据的约定和规范。


**解释一下在浏览器里面点击页面链接后发生了什么**

浏览器判断是不是ip地址，不是就进行域名解析，依次通过浏览器缓存，系统缓存，host文件，还是没找到的请求 DNS 服务器获取 IP 解析(解析失败的浏览器尝试换别的 DNS 服务器，最终失败的进入错误页面)，有可能获取到 CDN 服务器 IP 地址，访问CDN 时先看是否缓存了，缓存了响应用户，无法缓存，缓存失效或者无缓存，回源到服务器。经过防火墙外网网管路由到 nginx 接入层。ng缓存中存在的直接返回，不存在的负载到 web 服务器。 web服务器接受到请求后处理路径不存在 404。存在的返回结果(服务器中也会有 redis,ehcache（堆内外缓存）,disk 等缓存策略)，原路返回， CDN 加入缓存响应用户。


**安全与幂等**

所谓的安全是指请求方法不会破坏服务器上的资源，即不会对服务器上的资源造成实质的修改。

按照这个定义，只有Get 和 HEAD 方法是安全的，因为它们是只读操作，只要服务器不故意曲解请求方法的处理方式，无论GET和 HEAD 操作多少次，服务器上的数据都 是安全的。

幂等实际上是一个数学用语，被借用到  HTTP 协议里面，意思是多次执行相同的操作，结果也是相同的，即多次“幂”后结果相等。


**什么是 URI**

URI 是用来唯一标记服务器上资源的一个字符串，通常也称为 URL。

URI 通常由 scheme,host:port, path, query 四个部门组成，有的可以省略。

scheme 叫方案名或者 协议名，表示资源应该使用哪个协议来访问。

host:port 表示资源所在的主机名和端口号

path 标记资源所在的位置。

query 表示对资源附加的额外要求。



#### 响应状态码怎么用

2xx 类状态码表示成功，常用的有 200，204， 206

200 ok 是最常见的成功状态码，表示一切正常。

204 No Content 是另一个很常见的成功状态码，它的含义与 "200 OK" 基本相同，但响应头后没有 body 数据。所以对于  Web 服务器来产，正确区分 200 和 204 是很必要的。


206 partial Content 是 HTTP 分块下载或断点续传的基础，在客户端发送"范围请求"，要求获取资源的部分数据时出现，它与200一样，也是服务器成功处理了请求，但 body 里面的数据不是资源的全部，而是其中一部分。

206 通常还会伴随着字段 Content-Range 表示响应报文 body 数据的具体范围，供客户端确认。

3xx 类状态码表示重新向，常用的有 301, 302, 304。


301 Moved Permanently 永久重定向，含义是此次请求的资源已经不存在了，需要改用新的 URI 再次访问。

302 是临时重定向。

303 See Other: 类似 302，但要求重写向后请求改为 GET 方法，访问一个结果页面，避免 POST/PUT 重复操作。




304 No Modified 用于 if-modified-since 等条件请求，表示资源未修改，用于缓存控制。



4xx 类状态码表示客户端错误，常用的有 400, 403, 404.


400 Bad Request 是一个通用的错误码，表示请求报文有错误。

403 Forbidden 实际上不是客户端的请求出错，而是表示服务器禁止访问资源。

404 Nod Found 资源在本服务器上未找到，所以无法提供给客户端。


5xx 类状态码表示服务器错误，常用的有 500, 501, 502, 503。


500 与 400 类似，也是一个通用的错误码，服务器究竟发生了什么错误我们是不知道 了



501 Not Implemented 表示客户端请求功能还不支持。


502 Bad Gateway 通常是服务器作为网关或者代理时返回的错误码。


503 Service Unavailable 表示服务器当前很忙，暂时无法响应服务，我们上网有时候遇到网络服务下忙，请稍后 重的状态码就是 503。


#### HTTP 有哪些特点？

1. HTTP 是灵活可以扩展的，可以任意添加头字段实现任意功能。

2. HTTP 是可靠传输协议，基于 TCP/IP 协议 "尽量"保证数据的送达。

3. HTTP 是应用层协议，比 FTP， SSH 等更通用功能更多，能够传输任意数据。

4. HTTP 使用了请求-应答模式，客户端主动发起请求，服务器被动回复请求。

5. HTTP 本质上是无状态的，每个请求都是互相独立，毫无关联的，协议不要求客户端或服务器记录请求相关的信息。


HTTP 有哪些优点 和缺点

1 .HTTP 最大的优点是简单，灵活和易于扩展

2. HTTP 拥有成熟的软硬件环境，应用的非常广泛，是互联网的基础设施。

3. HTTP 是无状态的，可以轻松实现集群化，扩展性能，但有时也需要用 Cookie技术实现有状态。
  
4. HTTP 是明文传输，数据完全肉眼可见，能够方便地研究分析，但也容易被窃听。

5. HTTP 是不安全的，无法验证通信双方的身份，也不能判断报文是否被窜改。

6. HTTP 的性能不算差，但不完全适应现在的互联网，还有很大的提升空间。




#### Cookie 相关


1.响应报文使用 Set-Cookie 字段发送 "key=value" 形式的 Cookie 值。
2.为了保护 Cookie 还要给它设置有效期，作用域等属性，常用的有 Max-Age ,Expires、Domain、HttpOnly等。

3. Expires 俗称 过期时间， 用的是绝对时间点，可以理解为 截至日期。 Max-Age 用的是相对时间，单位是秒，浏览器用收到的报文的时间点再加上 Max-Age，就可以得到失效绝对时间。

4. HttpOnly 会午夜浏览器，此 Cookie 只能通过浏览器 HTTP 协议传输，禁止其它方式访问，浏览器的 JS 引擎就会禁用 document.cookie 等一切相关的 ApI，脚本攻击也就无从谈起。

5. SameSite 可以防范 “跨站请求伪造 XSRF” 攻击，设置 "SameSite=Strict" 可以严格限定 Cookie 不能随着跳转链接跨站发送，而
“SameSite=Lax” 则宽松一点，允许 Get/Head 等安全方法，但禁止 Post 跨站发送。

6. Secure 表示这个 Cookie 仅能用 HTTPS 协议加密传输。

### HTTP 缓存

1.服务器标记资源有效期使用的头字段是 "Cache-Control",里面的值 "max-age = 30" 就是资源的有效时间，相当于告诉浏览器，这个页面只能缓存 30 秒，之后就算是过期，不能用。

2.no-store 不允许缓存，用于某些变化非常频繁的数据，例如 秒杀页面。

3.no-cache 它的字面含义容易与 no-store 搞混，实际的意思并不是不允许缓存，而是可以缓存，但在使用之前必须要去服务器验证是否过期，是否有最新的版本。

4.must-revalidate:又是一个和 no-chche相似的词，它的意思是如果缓存不过期就可以继续使用，但过期了如果还想用就必须去服务器验证。

![](https://klxxcdn.oss-cn-hangzhou.aliyuncs.com/histudy/hrm/media/cache.jpg)


5.当你点 "刷新" 按钮的时候，浏览器会在请求头里加一个 "Cache-Control:max-age = 0"。因为 max-age 是 "生存时间" ，0表示 “我要一个最新鲜的西瓜”，而本地缓存里的数据至少保存了几秒钟，所以浏览器就不会使用缓存，而是向服务器发请求。服务器看到 max-age = 0 也就会用一个最新生成的报文回应浏览器。


6. Ctrl+F5 的强制刷新，其实是发了一个 "Cache-Control":no-cache，含义和 "max-age=0" 基本一样，就看后台的服务器怎么理解，通常两者的效果是相同。


7. ETag 是 "实体标签" (Entity Tag) 的缩小，是资源的一个唯一标识，主要是用来解决修改时间无法准确区分文件变化的问题。

比如，一个文件在一秒内修改了多次，但因为修改时间是秒级，所以这一秒内的新版本无法区分。


再比如，一个文件定期更新，但有时会是同样的内容，实际上没有变化，用修改时间就会误以为发生了变化，传送给浏览器就会浪费带宽。



### HTTP 代理

HTTP代理就是客户端和服务器通信链路中的一个中间环节，为两端提供 "代理服务"；

2.代理处于中间层，为 HTTP 处理增加了更多的灵活发，可以实现负载均衡，安全防护，数据过滤等功能。

3.代理服务器需要使用字段 Via 标记自己的身份，多个代理会形成一个列表。


4.如果想要知道客户端的真实 IP 地址，可以使用字段 "X-Forwarded-For" 和 X-Real-IP 



### HTTPS 相关

1.HTTP是明文传输，所以不安全，容易被黑客窃听和篡改

2.通信安全必须同时具备机密性、完整性、身份认证和不可否认这四个特性。

3.HTTPS 的语法，语义仍然是 HTTP，但把下层的协议由 TCP/IP换成了 SSL/TLS

4.SSL/TLS 是信息安全领域中的权威标识，采用多种先进的加密技术保证通信安全

5.OpenSSL 是著名的开源密码学工具包，是 SSL/TLS 的具体实现。


HTTPS 凭什么就能做到机密性、完整性这些安全特性呢？

秘密就在于它把 HTTP 下层的传输协议由 TCP/IP 换成了 SSL/TLS，由 "HTTP over TCP/IP" 变成了 "HTTP over SSL/TLS",让 HTTP 运行在了安全的 SSL/TLS 协议上，收发报文不再使用 Socket API，而是调用专门的安全接口。


![](https://klxxcdn.oss-cn-hangzhou.aliyuncs.com/histudy/hrm/media/SSLTLS.jpg)



### 对称加密和非对称加密

1.加密算法的核心思想是"把一个小秘密(密钥)转化了小秘密(密文消息)，守住了小秘密，也就守住了大秘密"


2.对称加密只使用一个密钥，运算速度快，密钥必须保密，无法做到安全的密钥交换，常用的有 AES 和 ChaCha20


3.非对称加密使用两个密钥：公钥和密钥，公钥可以任意分发而私钥保密，解决了密钥交换问题但速度比慢，常用 的RSA和 ECC。

4.把对称加密和非对称加密结合进来就得到  "又好又快" 的混合加密，也就是 TLS 里使用的加密方式。